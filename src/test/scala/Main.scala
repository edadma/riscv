//@
package xyz.hyperreal.riscv


object Main extends App {
//  println( "opcodes..." )
//
//  val cpu = new CPU(
//    new Memory {
//      def init: Unit = {
//        removeDevices
//        regions.clear
//        add( new RAM("ram", 0x10000, 0x1FFFF) )
//        add( ROM.code("program", 0x0000, List(
//          itype( 1, 0, 'b000, 1, 'b0010011 ),
//          itype( 0, 0, 'b000, 2, 'b0010011 ),
//          utype( 1000, 2, 'b0010111 ),
//          itype( 1, 1, 'b000, 1, 'b0010011 ),
//          btype( -4, 2, 1, 'b001, 'b1100011 ),
//          itype( 0, 0, 'b101, 0, 'b1110011 )
//        )) )
//      }
//    } )
//
//  println( "collect..." )
//
//  System.gc
//  System.gc
//  System.gc
//
//  val start = System.currentTimeMillis
//
//  println( "run..." )
//  cpu.run
//  println( (cpu.counter.toDouble/(System.currentTimeMillis - start)*1000).toInt + " instructions per second" )
//  println( cpu.x mkString ", " )

//  println( utype( 3, 15, 'b0110111 ).toHexString )
//
//  val cpu = new CPU(
//    new Memory {
//      def init: Unit = {
//        removeDevices
//        regions.clear
//        add( new RAM("ram", 0x10000, 0x1FFFF) )
//        add( ROM.code("program", 0x0000, List(
//          utype( 0x11, 15, 'b0110111 ),   // 000117B7
//          csrtype( 0, 0, 'b101, 0, 'b1110011 )
//        )) )
//      }
//    } )
//
//  cpu.run
//  cpu.registers

//  val cpu =
//    new CPU(
//      new Memory {
//        def init: Unit = {
//          removeDevices
//          regions.clear
//          add( new StdIOChar(0x20000) )
//          add( new RAM("ram", 0, 0xFFFF) )
//          addHexdump( io.Source.fromFile("examples/signum.hex") )
//        }
//      } ) {
////      trace = true
//      }
//
//  cpu.reset
//  cpu.run
//  cpu.registers

  val program =
    """
       |
 |Hex dump of section '.text':
 |  0x00010080 37010100 ef00c003 73500000 73500000 7.......sP..sP..
 |  0x00010090 00000000 00000000 00000000 00000000 ................
 |  0x000100a0 00000000 00000000 00000000 00000000 ................
 |  0x000100b0 00000000 00000000 00000000 00000000 ................
 |  0x000100c0 130101ff 23348100 13040101 b7070200 ....#4..........
 |  0x000100d0 13071006 2380e700 13000000 03348100 ....#........4..
 |  0x000100e0 13010101 67800000                   ....g...
 |
 |
    """.trim.stripMargin
//    """
//       |
// |Hex dump of section '.text':
// |  0x000100c0 37010100 ef004017 73500000 73500000 7.....@.sP..sP..
// |  0x000100d0 00000000 00000000 00000000 00000000 ................
// |  0x000100e0 00000000 00000000 00000000 00000000 ................
// |  0x000100f0 00000000 00000000 00000000 00000000 ................
// |  0x00010100 130101fe 233c8100 13040102 93070500 ....#<..........
// |  0x00010110 a307f4fe b7070200 0347f4fe 2380e700 .........G..#...
// |  0x00010120 13000000 03348101 13010102 67800000 .....4......g...
// |  0x00010130 130101fe 233c1100 23388100 13040102 ....#<..#8......
// |  0x00010140 2334a4fe 6f00c001 833784fe 13871700 #4..o....7......
// |  0x00010150 2334e4fe 83c70700 13850700 eff05ffa #4............_.
// |  0x00010160 833784fe 83c70700 e39007fe 1305a000 .7..............
// |  0x00010170 eff01ff9 13000000 83308101 03340101 .........0...4..
// |  0x00010180 13010102 67800000 130101fe 233c8100 ....g.......#<..
// |  0x00010190 13040102 93070500 2326f4fe 8327c4fe ........#&...'..
// |  0x000101a0 9b870700 63800702 8327c4fe 9b870700 ....c....'......
// |  0x000101b0 63d60700 9307f0ff 6f000001 93071000 c.......o.......
// |  0x000101c0 6f008000 93070000 13850700 03348101 o............4..
// |  0x000101d0 13010102 67800000 130101fe 233c1100 ....g.......#<..
// |  0x000101e0 23388100 13040102 93070500 2326f4fe #8..........#&..
// |  0x000101f0 8327c4fe 13850700 eff01ff9 93070500 .'..............
// |  0x00010200 9b871700 1b870700 b7170100 13173700 ..............7.
// |  0x00010210 9387072a b307f700 83b70700 13850700 ...*............
// |  0x00010220 eff01ff1 13000000 83308101 03340101 .........0...4..
// |  0x00010230 13010102 67800000 130101ff 23341100 ....g.......#4..
// |  0x00010240 23308100 13040101 1305b0ff eff0dff8 #0..............
// |  0x00010250 13050000 eff05ff8 1305800c eff0dff7 ......_.........
// |  0x00010260 13000000 83308100 03340100 13010101 .....0...4......
// |  0x00010270 67800000                            g...
// |
// |
// |Hex dump of section '.rodata':
// |  0x00010278 6e656761 74697665 00000000 00000000 negative........
// |  0x00010288 7a65726f 00000000 706f7369 74697665 zero....positive
// |  0x00010298 00                                  .
// |
// |
// |Hex dump of section '.data':
// |  0x000112a0 78020100 00000000 88020100 00000000 x...............
// |  0x000112b0 90020100 00000000                   ........
// |
// |
//    """.trim.stripMargin

  println( Run( program 	) )
  println( Run( program 	) )
}
